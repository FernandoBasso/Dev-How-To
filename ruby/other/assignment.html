<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>Assignment &ndash; Ruby</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="./pygments-default.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Assignment &ndash; Ruby</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_scope">Scope</a></li>
<li><a href="#_local_variables_and_methods">Local Variables and Methods</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_scope"><a class="link" href="#_scope">Scope</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Blocks create scope.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-mi">1</span><span class="tok-o">.</span><span class="tok-n">times</span> <span class="tok-k">do</span>
  <span class="tok-n">foo</span> <span class="tok-o">=</span> <span class="tok-mi">1</span>
  <span class="tok-n">bar</span> <span class="tok-o">=</span> <span class="tok-mi">2</span>
  <span class="tok-nb">puts</span> <span class="tok-nb">local_variables</span><span class="tok-o">.</span><span class="tok-n">empty?</span>     <span class="tok-c1"># →  false</span>
  <span class="tok-nb">puts</span> <span class="tok-nb">local_variables</span><span class="tok-o">.</span><span class="tok-n">length</span>     <span class="tok-c1"># →  2</span>
  <span class="tok-nb">puts</span> <span class="tok-nb">local_variables</span><span class="tok-o">.</span><span class="tok-n">join</span> <span class="tok-s1">&#39;, &#39;</span>
<span class="tok-k">end</span>
<span class="tok-c1"># →  false</span>
<span class="tok-c1"># →  2</span>
<span class="tok-c1"># →  foo, bar</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables created in an outer scope are visible inner block scopes, but not
inside method scope.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span class="tok-n">sneaky</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;hey there&#39;</span><span class="tok-p">;</span>

<span class="tok-mi">1</span><span class="tok-o">.</span><span class="tok-n">times</span> <span class="tok-k">do</span>
  <span class="tok-n">foo</span> <span class="tok-o">=</span> <span class="tok-mi">9</span>
  <span class="tok-n">bar</span> <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-mi">11</span>
  <span class="tok-nb">puts</span> <span class="tok-sx">%Q(Local variables: </span><span class="tok-si">#{</span><span class="tok-nb">local_variables</span><span class="tok-o">.</span><span class="tok-n">join</span> <span class="tok-s1">&#39;, &#39;</span><span class="tok-si">}</span><span class="tok-sx">)</span>
<span class="tok-k">end</span>
<span class="tok-c1"># →  Local variables: foo, bar, sneaky</span>

<span class="tok-nb">puts</span> <span class="tok-s2">&quot;Outer scope variables: </span><span class="tok-si">#{</span><span class="tok-nb">local_variables</span><span class="tok-o">.</span><span class="tok-n">join</span> <span class="tok-s1">&#39;, &#39;</span><span class="tok-si">}</span><span class="tok-s2">&quot;</span>
<span class="tok-c1"># →  Outer scope variables: sneaky</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre># FernandoBasso | “You may isolate variables in a block from the outer scope by listing them
#               | following a ; in the block’s arguments. See the documentation for block local
#               | variables in the calling methods documentation for an example.”
# FernandoBasso | Where is that found?
#         Radar | FernandoBasso: Citation needed.
# FernandoBasso | I am reading this, by the way:
#               | http://ruby-doc.org/core-2.1.2/doc/syntax/assignment_rdoc.html
#         Radar | FernandoBasso: Look in the sidebar. calling_methods.rdoc
#         Radar | FernandoBasso:
#               | http://ruby-doc.org/core-2.1.2/doc/syntax/calling_methods_rdoc.html
# FernandoBasso | Ah, "in the calling methods documentation"...
# FernandoBasso | Radar: silly me.
# FernandoBasso | Thanks.
#         Radar | FernandoBasso: np
#        Ox0dea | FernandoBasso: I'm not sure why that's in the 2.1 documentation; the semicolon
#               | hasn't been necessary since 1.9.
#        Ox0dea | 18&gt;&gt; foo = 1; proc { |foo| foo = 2 }.call(0); foo
#        ruboto | Ox0dea # =&gt; 2 (https://eval.in/430253)
#        Ox0dea | 19&gt;&gt; foo = 1; proc { |foo| foo = 2 }.call(0); foo
#        ruboto | Ox0dea # =&gt; 1 (https://eval.in/430254)
#        Ox0dea | In short, feel free to pretend you never knew you could stick semicolons in
#               | block argument lists. :P

# FernandoBasso | I misunderstood the docs.
# FernandoBasso | I was thinking it would be possible to make the a variable (in the example)
#               | not to "leak" into the block.
# FernandoBasso | What the call_method doc talks about is a way not to let outer variables
#               | interfere with block variables with the same name, it seems.

#       drbrain | Ox0dea: your example shows a different thing than what block local arguments
#               | does
#       drbrain | &gt;&gt; foo = 1; proc { foo = 2 }.call; p foo
#        ruboto | drbrain # =&gt; 2 ...check link for more (https://eval.in/430255)
#       drbrain | &gt;&gt; foo = 1; proc { |;foo| foo = 2 }.call; p foo
#        ruboto | drbrain # =&gt; 1 ...check link for more (https://eval.in/430256)
#        Ox0dea | Oh, right.
#       drbrain | block local arguments allow you to make arbitrary variables behave like block
#               | arguments
#       drbrain | FernandoBasso: ↑
# FernandoBasso | ✓
#        Ox0dea | It puts me in mind of K&amp;R-era function definition.</pre>
</div>
</div>
<div class="paragraph">
<p>Variables created in an outer scope are not visible in inner methods scope,
unlike do/end and {} blocks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-n">foo</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;try me&#39;</span><span class="tok-p">;</span>

<span class="tok-k">def</span> <span class="tok-nf">show_foo</span>
  <span class="tok-nb">puts</span> <span class="tok-n">foo</span>
<span class="tok-k">end</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Although <code>foo</code> is not visible inside <code>show_foo</code>, running this code
does not produce an error. Why not?</p>
</div>
<div class="paragraph">
<p>Because we didn&#8217;t call <code>show_foo</code>. Call it and the error pops it.</p>
</div>
<div class="paragraph">
<p>Variables created in an outer scope are not visible in inner methods scope,
unlike do/end and {} blocks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span class="tok-n">foo</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;try me&#39;</span><span class="tok-p">;</span>

<span class="tok-k">def</span> <span class="tok-nf">show_foo</span>
  <span class="tok-nb">puts</span> <span class="tok-n">foo</span>
<span class="tok-k">end</span>

<span class="tok-n">show_foo</span>

<span class="tok-c1"># → 002c.rb:8:in `show_foo&#39;: undefined local variable or method `foo&#39; for main:Object (NameError)</span>
<span class="tok-c1"># →         from 002c.rb:11:in `&lt;main&gt;&#39;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-n">foo</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;try me&#39;</span><span class="tok-p">;</span> <span class="tok-k">def</span> <span class="tok-nf">show_foo</span> <span class="tok-n">arg</span><span class="tok-p">;</span> <span class="tok-nb">puts</span> <span class="tok-n">arg</span><span class="tok-p">;</span> <span class="tok-k">end</span><span class="tok-p">;</span> <span class="tok-n">show_foo</span> <span class="tok-n">foo</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>But&#8230;&#8203; for loops do NOT create scope (unlike other blocks).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span class="tok-k">for</span> <span class="tok-n">i</span> <span class="tok-k">in</span> <span class="tok-mi">1</span><span class="tok-o">.</span><span class="tok-n">.</span><span class="tok-mi">3</span>
  <span class="tok-nb">puts</span> <span class="tok-n">i</span>
<span class="tok-k">end</span>
<span class="tok-c1"># →  1</span>
<span class="tok-c1"># →  2</span>
<span class="tok-c1"># →  3</span>

<span class="tok-nb">puts</span> <span class="tok-s2">&quot;Once more: </span><span class="tok-si">#{</span><span class="tok-n">i</span><span class="tok-si">}</span><span class="tok-s2">&quot;</span>
<span class="tok-c1"># →  Once more: 3</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you see, <code>i</code> is still accessible outside the <code>for</code> block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span class="tok-n">foo</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;the force&#39;</span>

<span class="tok-k">def</span> <span class="tok-nf">show_it</span>
  <span class="tok-nb">puts</span> <span class="tok-n">foo</span>
<span class="tok-k">end</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Q: When if you run the code above, even though <code>foo</code> is local to “that” scope
(and therefore not accessible inside the method <code>show_it</code>) you don&#8217;t get
errors?</p>
</div>
<div class="paragraph">
<p>A: Because the method insn&#8217;t actually called. It is simply defined.</p>
</div>
<div class="paragraph">
<p>BEWARE: Incorrect ruby code only produces errors when run, not when
it simply exists in the file.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_local_variables_and_methods"><a class="link" href="#_local_variables_and_methods">Local Variables and Methods</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>How does Ruby decide if <code>foo</code> is a variable or a method?
If it sees <code>foo</code> has been assigned a value, it thinks it is a variable,
otherwise it thinks it is a method.</p>
</div>
<div class="paragraph">
<p>Many times when you see a <code>no method named &#8230;&#8203;</code> while trying to use
a variable, it is very likely that it is a scope problem. You have that
variable but in another scope. Example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span class="tok-k">class</span> <span class="tok-nc">Thing</span>
  <span class="tok-k">def</span> <span class="tok-nf">foo</span>
    <span class="tok-n">bar</span>
  <span class="tok-k">end</span>
<span class="tok-k">end</span>

<span class="tok-n">obj</span> <span class="tok-o">=</span> <span class="tok-no">Thing</span><span class="tok-o">.</span><span class="tok-n">new</span>
<span class="tok-nb">puts</span> <span class="tok-n">obj</span><span class="tok-o">.</span><span class="tok-n">foo</span>
<span class="tok-c1"># → “undefined local variable or method bar”.</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ruby didn&#8217;t see an assignment to <code>bar</code>, therefore, it assumes <code>bar</code> is a
method and attempts to call it.</p>
</div>
<div class="paragraph">
<p>Does not assign to <code>bar</code>. Still, it tells the interpreter that <code>bar</code> is a
variable (which gets assigned nil). The local variable is created when the
parser encounters the assignment, not when the assignment occurs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-n">bar</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">.</span><span class="tok-mi">14</span> <span class="tok-k">if</span> <span class="tok-kp">false</span>
<span class="tok-nb">puts</span> <span class="tok-n">bar</span>
<span class="tok-c1"># →  nil or an empty line.</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span class="tok-n">jedi</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;the force&#39;</span> <span class="tok-k">if</span> <span class="tok-kp">true</span>
<span class="tok-nb">puts</span> <span class="tok-n">jedi</span>
<span class="tok-c1"># →  &#39;the force&#39;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nb">puts</span> <span class="tok-n">flag</span> <span class="tok-k">if</span> <span class="tok-n">flag</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">.</span><span class="tok-n">zero?</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span class="tok-nb">puts</span> <span class="tok-n">foo</span>    <span class="tok-c1"># → error about no method foo. Aborts execution.</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ruby"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span class="tok-k">def</span> <span class="tok-nf">sum</span><span class="tok-p">(</span><span class="tok-n">foo</span><span class="tok-p">,</span> <span class="tok-n">bar</span><span class="tok-p">)</span>
  <span class="tok-n">foo</span> <span class="tok-o">+</span> <span class="tok-n">bar</span>
<span class="tok-k">end</span>

<span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">5</span>
<span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-mi">2</span>

<span class="tok-c1"># TODO: not correct bcause sum takes params.</span>
<span class="tok-c1"># Creates a variable sum, so, we MUST use parenthesis to call the</span>
<span class="tok-c1"># method sum to avoid driving the ruby interpreter crazy.</span>

<span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-p">,</span> <span class="tok-n">b</span><span class="tok-p">)</span>

<span class="tok-nb">puts</span> <span class="tok-n">sum</span>

<span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">9</span>
<span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-mi">1</span>
<span class="tok-c1"># To call `sum` as a method again, we must do</span>
<span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-p">,</span> <span class="tok-n">b</span><span class="tok-p">)</span>
<span class="tok-nb">puts</span> <span class="tok-n">sum</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>When a method that takes no arguments share the same name with a variable,
you&#8217;ve got to use parentheses or self.method to call the method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>def sum
  2 + 3
end

sum = sum()
puts sum

sum = self.sum
puts sum</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>puts foo if foo = 0.zero?</pre>
</div>
</div>
<div class="paragraph">
<p>Rather than printing “true” you receive a NameError, “undefined local variable
or method `a’”. Since ruby parses the bare a left of the if first and has not
yet seen an assignment to a it assumes you wish to call a method. Ruby then
sees the assignment to a and will assume you are referencing a local method.</p>
</div>
<div class="paragraph">
<p>The confusion comes from the out-of-order execution of the expression. First
the local variable is assigned-to then you attempt to call a nonexistent
method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bar = 3.14 if false
puts bar

jedi = 'the force' if true
puts jedi</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-03-29 13:37:26 BRT
</div>
</div>
</body>
</html>